<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>monn Studios - Luna Net</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;400;600;700&family=Audiowide&family=Iceberg&display=swap"
        rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            background: #000000;
            color: #ffffff;
            overflow: hidden;
            height: 100vh;
        }

        .space-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 30%, rgba(40, 40, 40, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(60, 60, 60, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(20, 20, 20, 0.6) 0%, #000000 100%);
            z-index: 1;
        }

        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .star {
            position: absolute;
            background: #ffffff;
            border-radius: 50%;
            animation: twinkle 4s ease-in-out infinite;
            will-change: transform, opacity;
            transition: all 0.2s ease;
        }

        .star.medium {
            background: #cccccc;
            animation-duration: 5s;
        }

        .star.dim {
            background: #888888;
            animation-duration: 6s;
        }

        .star.bright {
            background: #ffffff;
            box-shadow: 0 0 8px #ffffff;
            animation-duration: 3s;
        }

        @keyframes twinkle {

            0%,
            100% {
                opacity: 0.4;
                transform: scale(1);
            }

            50% {
                opacity: 1;
                transform: scale(1.2);
            }
        }

        .shooting-star {
            position: absolute;
            width: 3px;
            height: 3px;
            background: linear-gradient(45deg, #ffffff, #cccccc);
            border-radius: 50%;
            animation: shoot 4s linear infinite;
            box-shadow: 0 0 10px #ffffff;
        }

        @keyframes shoot {
            0% {
                transform: translateX(-200px) translateY(200px);
                opacity: 0;
            }

            10% {
                opacity: 1;
            }

            90% {
                opacity: 1;
            }

            100% {
                transform: translateX(calc(100vw + 200px)) translateY(-200px);
                opacity: 0;
            }
        }

        .container {
            position: relative;
            z-index: 10;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            animation: fade-in 2s ease-out;
        }

        @keyframes fade-in {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .logo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ffffff 0%, #cccccc 50%, #888888 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            border: 2px solid #ffffff;
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
            animation: logo-pulse 3s ease-in-out infinite;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logo:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 0 50px rgba(255, 255, 255, 0.6);
        }

        .logo::before {
            content: '';
            position: absolute;
            width: 140px;
            height: 140px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            animation: logo-ring 8s linear infinite;
        }

        @keyframes logo-pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        @keyframes logo-ring {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .logo-text {
            font-family: 'Audiowide', cursive;
            font-size: 24px;
            font-weight: 400;
            color: #000000;
        }

        .main-title {
            font-family: 'Audiowide', cursive;
            font-size: 4rem;
            font-weight: 400;
            background: linear-gradient(135deg, #ffffff 0%, #cccccc 50%, #888888 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            letter-spacing: 3px;
            animation: title-glow 4s ease-in-out infinite;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .main-title:hover {
            transform: scale(1.02);
            letter-spacing: 5px;
        }

        @keyframes title-glow {

            0%,
            100% {
                text-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
                filter: brightness(1);
            }

            50% {
                text-shadow: 0 0 40px rgba(255, 255, 255, 0.6);
                filter: brightness(1.1);
            }
        }

        .subtitle {
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.2rem;
            font-weight: 400;
            color: #cccccc;
            margin-bottom: 50px;
            max-width: 600px;
            line-height: 1.5;
        }

        .countdown {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .time-unit {
            text-align: center;
            min-width: 90px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .time-unit::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 4s ease-in-out infinite;
        }

        .time-unit:hover {
            transform: translateY(-5px) scale(1.05);
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 10px 30px rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
        }

        @keyframes shimmer {
            0% {
                left: -100%;
            }

            50% {
                left: 100%;
            }

            100% {
                left: 100%;
            }
        }

        .time-number {
            font-family: 'Iceberg', cursive;
            font-size: 3.5rem;
            font-weight: 400;
            color: #ffffff;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
            display: block;
            margin-bottom: 5px;
            transition: all 0.3s ease;
        }

        .time-number.changing {
            animation: number-flip 0.6s ease-in-out;
        }

        @keyframes number-flip {
            0% {
                transform: rotateY(0deg) scale(1);
            }

            50% {
                transform: rotateY(90deg) scale(1.1);
            }

            100% {
                transform: rotateY(0deg) scale(1);
            }
        }

        .time-label {
            font-family: 'Rajdhani', sans-serif;
            font-size: 0.8rem;
            font-weight: 600;
            color: #888888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Botón de configuración público */
        .config-button-public {
            position: fixed;
            top: 30px;
            right: 30px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            color: #ffffff;
            font-size: 18px;
            cursor: pointer;
            z-index: 15;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .config-button-public:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        /* Sistema de Login */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 100;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .login-box {
            background: rgba(20, 20, 20, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            min-width: 350px;
            box-shadow: 0 0 50px rgba(255, 255, 255, 0.1);
            animation: login-appear 0.5s ease-out;
        }

        @keyframes login-appear {
            from {
                opacity: 0;
                transform: scale(0.8);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .login-title {
            font-family: 'Audiowide', cursive;
            font-size: 1.8rem;
            margin-bottom: 30px;
            color: #ffffff;
        }

        .login-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            font-family: 'Rajdhani', sans-serif;
            font-size: 1rem;
        }

        .login-input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.6);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
        }

        .login-button {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            font-family: 'Rajdhani', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .error-message {
            color: #ff6b6b;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .blocked-message {
            color: #ff9f43;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        /* Panel de Configuración */
        .config-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
            z-index: 20;
            font-family: 'Rajdhani', sans-serif;
            min-width: 280px;
            transition: transform 0.3s ease;
            display: none;
        }

        .config-panel.show {
            display: block;
            animation: config-appear 0.5s ease-out;
        }

        @keyframes config-appear {
            from {
                opacity: 0;
                transform: translateX(100%);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .config-panel.collapsed {
            transform: translateX(calc(100% - 60px));
        }

        .config-toggle {
            position: absolute;
            left: -40px;
            top: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px 0 0 5px;
            padding: 10px;
            cursor: pointer;
            color: #ffffff;
        }

        .config-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #ffffff;
            text-align: center;
        }

        .config-group {
            margin-bottom: 15px;
        }

        .config-input,
        .config-button {
            width: 100%;
            padding: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            font-family: 'Rajdhani', sans-serif;
        }

        .config-button {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .config-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .quick-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 15px;
        }

        .quick-btn {
            padding: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            font-family: 'Rajdhani', sans-serif;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .logout-btn {
            background: rgba(255, 100, 100, 0.2);
            border-color: rgba(255, 100, 100, 0.5);
        }

        /* Efectos dinámicos */
        .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            animation: ripple-effect 0.8s ease-out;
            pointer-events: none;
        }

        @keyframes ripple-effect {
            0% {
                transform: scale(0);
                opacity: 1;
            }

            100% {
                transform: scale(4);
                opacity: 0;
            }
        }

        @media (max-width: 768px) {
            .main-title {
                font-size: 2.5rem;
                letter-spacing: 2px;
            }

            .time-number {
                font-size: 2.5rem;
            }

            .countdown {
                gap: 15px;
            }

            .config-button-public {
                width: 45px;
                height: 45px;
                font-size: 16px;
            }
        }
    </style>
</head>

<body>
    <div class="space-bg">
        <div class="stars" id="stars"></div>
    </div>

    <!-- Botón público de configuración - SIMPLIFICADO -->
    <button class="config-button-public" id="configBtn" title="Configuración">⚙️</button>

    <!-- Sistema de Login -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-box">
            <div class="login-title">ACCESO RESTRINGIDO</div>
            <input type="text" class="login-input" id="username" placeholder="Usuario" autocomplete="username">
            <input type="password" class="login-input" id="password" placeholder="Contraseña"
                autocomplete="current-password">
            <button class="login-button" id="loginBtn" onclick="attemptLogin()">ACCEDER</button>
            <div class="error-message" id="errorMessage"></div>
            <div class="blocked-message" id="blockedMessage"></div>
        </div>
    </div>

    <!-- Panel de Configuración -->
    <div class="config-panel" id="configPanel">
        <div class="config-toggle" onclick="toggleConfig()">⚙️</div>
        <div class="config-title">CONFIGURACIÓN AVANZADA</div>

        <div class="quick-buttons">
            <button class="quick-btn" onclick="setQuickDate(1, 'days')">1 Día</button>
            <button class="quick-btn" onclick="setQuickDate(7, 'days')">1 Semana</button>
            <button class="quick-btn" onclick="setQuickDate(1, 'months')">1 Mes</button>
            <button class="quick-btn" onclick="setQuickDate(3, 'months')">3 Meses</button>
        </div>

        <div class="config-group">
            <input type="datetime-local" class="config-input" id="targetDateTime">
        </div>

        <div class="config-group">
            <button class="config-button" onclick="updateCountdown()">Actualizar Cuenta</button>
        </div>

        <div class="config-group">
            <button class="config-button" onclick="resetToDefault()">Restablecer</button>
        </div>

        <div class="config-group">
            <button class="config-button logout-btn" onclick="logout()">Cerrar Sesión</button>
        </div>
    </div>

    <div class="container">
        <div class="logo">
            <span class="logo-text">MS</span>
        </div>

        <h1 class="main-title">monn Studios</h1>

        <p class="subtitle">
            INICIANDO CUENTA REGRESIVA PARA LANZAMIENTO DE LUNA NET
        </p>

        <div class="countdown" id="countdown">
            <div class="time-unit">
                <span class="time-number" id="days">29</span>
                <span class="time-label">DÍAS</span>
            </div>
            <div class="time-unit">
                <span class="time-number" id="hours">23</span>
                <span class="time-label">HORAS</span>
            </div>
            <div class="time-unit">
                <span class="time-number" id="minutes">59</span>
                <span class="time-label">MINUTOS</span>
            </div>
            <div class="time-unit">
                <span class="time-number" id="seconds">44</span>
                <span class="time-label">SEGUNDOS</span>
            </div>
        </div>
    </div>

    <script>
        // ==============================================
        // VARIABLES GLOBALES Y CONFIGURACIÓN MONGODB
        // ==============================================

        let targetDate = null;
        let isAuthenticated = false;
        let failedAttempts = 0;
        let mouseX = 0, mouseY = 0;
        let stars = [];
        let lastMouseUpdate = 0;

        const CREDENTIALS = {
            username: 'AndreSM',
            password: 'andre1589'
        };

        // 🔗 CONFIGURACIÓN MONGODB - COMPLETAMENTE AUTOMÁTICA
        const MONGODB_CONFIG = {
            // 👇 SOLO PEGA TU CONNECTION STRING AQUÍ Y LISTO
            connectionString: "mongodb+srv://fabian1234andre:GWOLQUQqWRu2MPZ9@cluster0.ttvffqo.mongodb.net/?retryWrites=true&w=majority&appName=Cluster0", // mongodb+srv://usuario:password@cluster0.xxxxx.mongodb.net/...

            // URLs automáticas - detecta local vs producción
            get apiUrl() {
                const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
                return isLocal ? 'http://localhost:3000/api' : 'https://monn-studios-backend.onrender.com/api';
            },

            // Se activa automáticamente cuando hay connection string
            get enabled() {
                return this.connectionString && this.connectionString.trim() !== "";
            },

            // Auto-detecta si somos administrador o visitante
            get isAdmin() {
                return isAuthenticated; // Solo cuando el admin está logueado
            }
        };

        // ==============================================
        // FUNCIONES DE MONGODB - COMPLETAMENTE AUTOMÁTICAS
        // ==============================================

        async function mongoSaveConfig(targetDate) {
            try {
                console.log('☁️ GUARDANDO CONFIGURACIÓN GLOBAL...');
                console.log('👤 Solo el administrador puede hacer esto');

                const configDoc = {
                    _id: "global_countdown_config",
                    targetDate: targetDate.toISOString(),
                    configuredBy: 'AndreSM',
                    configuredAt: new Date().toISOString(),
                    lastUpdate: Date.now(),
                    isGlobal: true,
                    adminOnly: true
                };

                const response = await fetch(`${MONGODB_CONFIG.apiUrl}/config`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(configDoc),
                    timeout: 8000
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const result = await response.json();

                if (result.success) {
                    console.log('✅ ¡CONFIGURACIÓN GLOBAL GUARDADA!');
                    console.log('🌍 TODOS los visitantes verán esta fecha ahora');
                    saveLocalConfig(targetDate); // Backup local
                    return { success: true, source: 'mongodb', global: true };
                } else {
                    throw new Error(result.error || 'Error desconocido');
                }

            } catch (error) {
                console.log('⚠️ MongoDB no disponible:', error.message);
                console.log('📝 Guardando localmente como fallback');
                return saveLocalConfig(targetDate);
            }
        }

        async function mongoLoadConfig() {
            try {
                console.log('🌍 Cargando configuración GLOBAL desde la nube...');

                const response = await fetch(`${MONGODB_CONFIG.apiUrl}/config`, {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' },
                    timeout: 5000
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const result = await response.json();

                if (result.success && result.data) {
                    targetDate = new Date(result.data.targetDate);

                    console.log('✅ ¡CONFIGURACIÓN GLOBAL CARGADA!');
                    console.log(`🎯 Fecha configurada por el admin: ${targetDate.toLocaleString()}`);
                    console.log('👥 Esta fecha es para TODOS los visitantes');

                    saveLocalConfig(targetDate); // Backup local
                    return { success: true, source: 'mongodb', global: true, data: result.data };
                } else {
                    throw new Error('No hay configuración global');
                }

            } catch (error) {
                console.log('⚠️ No hay configuración global disponible:', error.message);
                console.log('📝 Usando configuración local');
                return loadLocalConfig();
            }
        }

        // Auto-detecta si debe usar MongoDB o localStorage
        async function autoLoadConfig() {
            if (MONGODB_CONFIG.enabled) {
                console.log('🚀 MODO AUTOMÁTICO: Intentando cargar configuración global...');
                const result = await mongoLoadConfig();

                if (result.success && result.source === 'mongodb') {
                    console.log('🌍 ¡Configuración global activa! Configurada por el administrador');
                    return result;
                } else {
                    console.log('📝 No hay configuración global, usando local');
                    return await loadLocalConfig();
                }
            } else {
                console.log('💻 MongoDB no configurado - modo local');
                return await loadLocalConfig();
            }
        }

        // Auto-detecta si debe guardar en MongoDB o localStorage
        async function autoSaveConfig(targetDate) {
            if (MONGODB_CONFIG.enabled && MONGODB_CONFIG.isAdmin) {
                console.log('🔐 ADMINISTRADOR DETECTADO - Guardando GLOBALMENTE...');
                const result = await mongoSaveConfig(targetDate);

                if (result.success && result.source === 'mongodb') {
                    console.log('✅ ¡Configuración guardada para TODOS los usuarios!');
                    return result;
                } else {
                    console.log('📝 Fallback: Guardado localmente');
                    return saveLocalConfig(targetDate);
                }
            } else if (MONGODB_CONFIG.enabled && !MONGODB_CONFIG.isAdmin) {
                console.log('👀 Visitante: No puede modificar configuración global');
                // Los visitantes no pueden guardar, solo cargan
                return { success: false, reason: 'visitor' };
            } else {
                console.log('💻 Modo local - guardando en localStorage');
                return saveLocalConfig(targetDate);
            }
        }

        // ==============================================
        // FUNCIONES LOCALES (BACKUP)
        // ==============================================

        function saveLocalConfig(date) {
            try {
                const config = {
                    targetDate: date.toISOString(),
                    configuredBy: 'AndreSM',
                    configuredAt: new Date().toISOString(),
                    source: 'localStorage'
                };

                localStorage.setItem('monn_studios_config', JSON.stringify(config));
                targetDate = date;

                console.log('💾 Configuración guardada en localStorage');
                return { success: true, source: 'localStorage' };
            } catch (e) {
                console.error('❌ Error guardando en localStorage:', e);
                targetDate = date; // Al menos mantener en sesión
                return { success: false, error: e.message };
            }
        }

        function loadLocalConfig() {
            try {
                const savedConfig = localStorage.getItem('monn_studios_config');

                if (savedConfig) {
                    const config = JSON.parse(savedConfig);
                    targetDate = new Date(config.targetDate);

                    console.log('📥 Configuración cargada desde localStorage');
                    console.log(`🎯 Fecha objetivo: ${targetDate.toLocaleString()}`);

                    return { success: true, data: config, source: 'localStorage' };
                } else {
                    return { success: false, error: 'No config found' };
                }
            } catch (e) {
                console.error('❌ Error cargando desde localStorage:', e);
                return { success: false, error: e.message };
            }
        }

        // ==============================================
        // FUNCIONES BÁSICAS (SIN DEPENDENCIAS)
        // ==============================================

        function getBrowserFingerprint() {
            try {
                return btoa(navigator.userAgent.slice(0, 20) + screen.width).slice(0, 16);
            } catch (e) {
                return 'default_browser';
            }
        }

        function clearLoginFields() {
            const elements = {
                username: document.getElementById('username'),
                password: document.getElementById('password'),
                error: document.getElementById('errorMessage'),
                blocked: document.getElementById('blockedMessage'),
                loginBtn: document.getElementById('loginBtn')
            };

            if (elements.username) elements.username.value = '';
            if (elements.password) elements.password.value = '';
            if (elements.error) elements.error.textContent = '';
            if (elements.blocked) elements.blocked.textContent = '';
            if (elements.loginBtn) {
                elements.loginBtn.disabled = false;
                elements.loginBtn.textContent = 'ACCEDER';
            }
        }

        function showBlockedMessage(minutes) {
            console.log('⚠️ Usuario bloqueado por', minutes, 'minutos');

            const elements = {
                blocked: document.getElementById('blockedMessage'),
                loginBtn: document.getElementById('loginBtn'),
                overlay: document.getElementById('loginOverlay'),
                error: document.getElementById('errorMessage')
            };

            if (elements.blocked) {
                if (minutes >= 60) {
                    const hours = Math.floor(minutes / 60);
                    elements.blocked.textContent = `🔒 Bloqueado por ${hours} hora(s). Demasiados intentos fallidos.`;
                } else {
                    elements.blocked.textContent = `🔒 Bloqueado por ${minutes} minuto(s). Demasiados intentos fallidos.`;
                }
            }

            if (elements.loginBtn) {
                elements.loginBtn.disabled = true;
                elements.loginBtn.textContent = 'BLOQUEADO';
            }

            if (elements.error) elements.error.textContent = '';
            if (elements.overlay) elements.overlay.style.display = 'flex';
        }

        // ==============================================
        // FUNCIONES DE AUTENTICACIÓN SIMPLIFICADAS
        // ==============================================

        function openConfigSystem() {
            console.log('🔧 BOTÓN CLICKEADO!');

            if (isAuthenticated) {
                console.log('✅ Ya autenticado, mostrando panel');
                showConfigPanel();
                return;
            }

            console.log('🔐 No autenticado, mostrando login');
            showLoginDialog();
        }

        function showLoginDialog() {
            console.log('📋 Mostrando dialog de login...');

            const loginOverlay = document.getElementById('loginOverlay');
            if (!loginOverlay) {
                console.error('❌ Login overlay no encontrado');
                return;
            }

            // Limpiar campos
            const username = document.getElementById('username');
            const password = document.getElementById('password');
            const errorMsg = document.getElementById('errorMessage');
            const blockedMsg = document.getElementById('blockedMessage');

            if (username) username.value = '';
            if (password) password.value = '';
            if (errorMsg) errorMsg.textContent = '';
            if (blockedMsg) blockedMsg.textContent = '';

            // Mostrar login
            loginOverlay.style.display = 'flex';
            console.log('✅ Login mostrado exitosamente');

            // Focus en username
            setTimeout(() => {
                if (username) username.focus();
            }, 100);
        }

        function showConfigPanel() {
            console.log('⚙️ Mostrando panel de configuración...');

            const configPanel = document.getElementById('configPanel');
            if (!configPanel) {
                console.error('❌ Panel de configuración no encontrado');
                return;
            }

            configPanel.classList.add('show');
            configPanel.classList.remove('collapsed');
            console.log('✅ Panel mostrado exitosamente');

            // Auto-colapsar después de unos segundos
            setTimeout(() => {
                configPanel.classList.add('collapsed');
            }, 3000);
        }

        function attemptLogin() {
            console.log('🔑 Procesando login...');

            const username = document.getElementById('username');
            const password = document.getElementById('password');
            const errorMsg = document.getElementById('errorMessage');

            if (!username || !password) {
                console.error('❌ Campos no encontrados');
                return;
            }

            const user = username.value.trim();
            const pass = password.value.trim();

            console.log('👤 Usuario:', user);
            console.log('🔐 Password length:', pass.length);

            if (user === CREDENTIALS.username && pass === CREDENTIALS.password) {
                console.log('✅ ¡LOGIN EXITOSO!');

                // Marcar como autenticado
                isAuthenticated = true;

                // Cerrar login
                const loginOverlay = document.getElementById('loginOverlay');
                if (loginOverlay) {
                    loginOverlay.style.display = 'none';
                    console.log('🚪 Login cerrado');
                }

                // Mostrar panel de configuración
                showConfigPanel();

                // Cargar configuración
                loadConfiguration();

            } else {
                console.log('❌ Credenciales incorrectas');
                if (errorMsg) {
                    errorMsg.textContent = '❌ Usuario o contraseña incorrectos';
                }

                // Limpiar campos
                username.value = '';
                password.value = '';
            }
        }

        function logout() {
            console.log('🚪 Cerrando sesión...');

            isAuthenticated = false;

            // Ocultar todo
            const loginOverlay = document.getElementById('loginOverlay');
            const configPanel = document.getElementById('configPanel');

            if (loginOverlay) loginOverlay.style.display = 'none';
            if (configPanel) configPanel.classList.remove('show');

            console.log('✅ Sesión cerrada');
        }

        function toggleConfig() {
            console.log('🔄 Toggle config');

            if (!isAuthenticated) {
                showLoginDialog();
                return;
            }

            const panel = document.getElementById('configPanel');
            if (panel) {
                panel.classList.toggle('collapsed');
                console.log('Panel collapsed:', panel.classList.contains('collapsed'));
            }
        }

        // ==============================================
        // FUNCIONES DE CONFIGURACIÓN GLOBAL
        // ==============================================

        function setQuickDate(amount, unit) {
            console.log(`⏰ Configurando fecha rápida: ${amount} ${unit}`);

            const now = new Date();
            const target = new Date(now);

            if (unit === 'days') {
                target.setDate(target.getDate() + amount);
            } else if (unit === 'months') {
                target.setMonth(target.getMonth() + amount);
            }

            // Guardar globalmente para todos los usuarios
            saveGlobalConfiguration(target);

            const dateTimeString = target.toISOString().slice(0, 16);
            const dateTimeInput = document.getElementById('targetDateTime');
            if (dateTimeInput) {
                dateTimeInput.value = dateTimeString;
            }

            console.log(`✅ Fecha configurada globalmente: ${target.toLocaleString()}`);
        }

        function resetToDefault() {
            console.log('🔄 Restableciendo a valores por defecto...');

            const now = new Date();
            const defaultTarget = new Date(now.getTime() + (29 * 24 * 60 * 60 * 1000) + (23 * 60 * 60 * 1000) + (59 * 60 * 1000) + (44 * 1000));

            // Guardar globalmente para todos los usuarios
            saveGlobalConfiguration(defaultTarget);

            const dateTimeString = defaultTarget.toISOString().slice(0, 16);
            const dateTimeInput = document.getElementById('targetDateTime');
            if (dateTimeInput) {
                dateTimeInput.value = dateTimeString;
            }

            console.log(`✅ Fecha restablecida globalmente: ${defaultTarget.toLocaleString()}`);
        }

        function updateCountdown() {
            console.log('📅 Actualizando countdown con nueva fecha...');

            const dateTimeInput = document.getElementById('targetDateTime');
            if (dateTimeInput && dateTimeInput.value) {
                const newTarget = new Date(dateTimeInput.value);

                // Guardar globalmente para todos los usuarios
                saveGlobalConfiguration(newTarget);

                console.log(`✅ Nueva fecha guardada globalmente: ${newTarget.toLocaleString()}`);
                updateCountdownDisplay();
            }
        }

        function saveGlobalConfiguration(date) {
            // 🚀 COMPLETAMENTE AUTOMÁTICO
            console.log('🔄 Iniciando guardado automático...');

            autoSaveConfig(date).then(result => {
                if (result.success) {
                    if (result.source === 'mongodb') {
                        console.log('🌍 ¡CONFIGURACIÓN GLOBAL GUARDADA!');
                        alert('✅ ¡Configuración guardada globalmente!\n🌍 TODOS los visitantes verán esta nueva fecha.');
                    } else {
                        console.log('💻 Configuración guardada localmente');
                        alert('💻 Configuración guardada localmente.');
                    }
                } else if (result.reason === 'visitor') {
                    console.log('👀 Los visitantes no pueden modificar la configuración');
                    // No mostrar nada - los visitantes solo ven
                } else {
                    console.log('📝 Guardado en localStorage como fallback');
                    alert('📝 Configuración guardada como respaldo local.');
                }
                updateCountdownDisplay();
            }).catch(error => {
                console.log('❌ Error en guardado automático:', error);
                saveLocalConfig(date);
                updateCountdownDisplay();
                alert('⚠️ Configuración guardada localmente (error de conexión).');
            });
        }

        async function loadGlobalConfiguration() {
            console.log('🚀 Carga automática iniciada...');

            const result = await autoLoadConfig();

            if (result.success) {
                if (result.source === 'mongodb') {
                    console.log('🌍 ¡Configuración GLOBAL cargada!');
                    console.log('👤 Configurada por el administrador para todos');
                } else {
                    console.log('💻 Configuración local cargada');
                }

                // Actualizar input solo si somos admin autenticado
                if (isAuthenticated) {
                    const dateTimeInput = document.getElementById('targetDateTime');
                    if (dateTimeInput && targetDate) {
                        dateTimeInput.value = targetDate.toISOString().slice(0, 16);
                    }
                }
                return true;
            } else {
                console.log('📭 No hay configuración disponible');
                return false;
            }
        }

        async function loadConfiguration() {
            // 🚀 COMPLETAMENTE AUTOMÁTICO
            const hasConfig = await loadGlobalConfiguration();

            if (!hasConfig) {
                console.log('🏗️ Creando configuración por defecto...');
                const now = new Date();
                const defaultTarget = new Date(now.getTime() + (29 * 24 * 60 * 60 * 1000) + (23 * 60 * 60 * 1000) + (59 * 60 * 1000) + (44 * 1000));

                // Solo guardar si somos administrador autenticado
                if (isAuthenticated) {
                    console.log('👤 Administrador - guardando configuración por defecto globalmente');
                    saveGlobalConfiguration(defaultTarget);
                } else {
                    console.log('👀 Visitante - usando configuración temporal');
                    targetDate = defaultTarget;
                }
            }
        }

        function updateCountdownDisplay() {
            if (!targetDate) return;

            const now = new Date();
            const difference = targetDate - now;

            if (difference > 0) {
                const days = Math.floor(difference / (1000 * 60 * 60 * 24));
                const hours = Math.floor((difference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((difference % (1000 * 60)) / 1000);

                animateNumberChange('days', String(days).padStart(2, '0'));
                animateNumberChange('hours', String(hours).padStart(2, '0'));
                animateNumberChange('minutes', String(minutes).padStart(2, '0'));
                animateNumberChange('seconds', String(seconds).padStart(2, '0'));
            } else {
                ['days', 'hours', 'minutes', 'seconds'].forEach(id => {
                    const element = document.getElementById(id);
                    if (element) element.textContent = '00';
                });
            }
        }

        function animateNumberChange(elementId, newValue) {
            const element = document.getElementById(elementId);
            if (element && element.textContent !== newValue) {
                element.classList.add('changing');
                setTimeout(() => {
                    element.textContent = newValue;
                    element.classList.remove('changing');
                }, 300);
            }
        }

        // ==============================================
        // FUNCIONES DE ANIMACIÓN
        // ==============================================

        function createStarField() {
            const starsContainer = document.getElementById('stars');
            if (!starsContainer) return;

            const starCount = 60;

            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');

                const starTypes = ['star', 'star medium', 'star dim', 'star bright'];
                star.className = starTypes[Math.floor(Math.random() * starTypes.length)];

                const size = Math.random() * 2 + 1;
                star.style.width = size + 'px';
                star.style.height = size + 'px';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';

                star.dataset.speed = Math.random() * 5 + 2;

                starsContainer.appendChild(star);
                stars.push(star);
            }

            setInterval(createShootingStar, 12000);
        }

        function createShootingStar() {
            const star = document.createElement('div');
            star.className = 'shooting-star';
            star.style.left = Math.random() * 30 + '%';
            star.style.top = Math.random() * 40 + 10 + '%';

            const starsContainer = document.getElementById('stars');
            if (starsContainer) {
                starsContainer.appendChild(star);

                setTimeout(() => {
                    if (star.parentNode) {
                        star.parentNode.removeChild(star);
                    }
                }, 4000);
            }
        }

        function animateStarsWithMouse() {
            if (Math.random() > 0.1) {
                requestAnimationFrame(animateStarsWithMouse);
                return;
            }

            stars.forEach((star, index) => {
                if (index % 8 !== 0) return;

                const speed = parseFloat(star.dataset.speed) * 0.2;
                const offsetX = mouseX * speed;
                const offsetY = mouseY * speed;

                star.style.transform = `translate(${offsetX}px, ${offsetY}px)`;
            });

            requestAnimationFrame(animateStarsWithMouse);
        }

        function createRipple(element, e) {
            const ripple = document.createElement('div');
            ripple.className = 'ripple';

            const rect = element.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = e.clientX - rect.left - size / 2;
            const y = e.clientY - rect.top - size / 2;

            ripple.style.width = ripple.style.height = size + 'px';
            ripple.style.left = x + 'px';
            ripple.style.top = y + 'px';

            element.appendChild(ripple);

            setTimeout(() => {
                if (ripple.parentNode) {
                    ripple.parentNode.removeChild(ripple);
                }
            }, 800);
        }

        // ==============================================
        // EVENT LISTENERS Y INICIALIZACIÓN
        // ==============================================

        document.addEventListener('mousemove', (e) => {
            const now = Date.now();
            if (now - lastMouseUpdate > 32) {
                mouseX = (e.clientX / window.innerWidth - 0.5) * 2;
                mouseY = (e.clientY / window.innerHeight - 0.5) * 2;
                lastMouseUpdate = now;
            }
        });

        document.addEventListener('DOMContentLoaded', async function () {
            console.log('🚀 Iniciando monn Studios - Luna Net...');

            try {
                // 1. CONFIGURAR BOTÓN DE CONFIGURACIÓN PRIMERO
                const configBtn = document.getElementById('configBtn');
                if (configBtn) {
                    console.log('🔧 Configurando botón de configuración...');

                    configBtn.addEventListener('click', function (e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('🎯 ¡BOTÓN CLICKEADO!');
                        openConfigSystem();
                    });

                    console.log('✅ Botón de configuración listo');
                } else {
                    console.error('❌ Botón de configuración NO encontrado');
                }

                // 2. Verificar elementos críticos
                const loginOverlay = document.getElementById('loginOverlay');
                const configPanel = document.getElementById('configPanel');

                console.log('🔍 Verificando elementos:');
                console.log('- Login overlay:', !!loginOverlay);
                console.log('- Config panel:', !!configPanel);

                // 3. CARGAR CONFIGURACIÓN GLOBAL
                console.log('📥 Iniciando carga de configuración global...');
                await loadConfiguration(); // Ahora sí usamos await porque loadConfiguration es async

                // 4. Crear estrellas
                createStarField();
                console.log('✨ Estrellas creadas');

                // 5. Iniciar contador con la configuración cargada
                updateCountdownDisplay();
                setInterval(updateCountdownDisplay, 1000);
                console.log('⏰ Contador iniciado con configuración global');

                // 6. Animaciones
                if (navigator.hardwareConcurrency >= 2) {
                    animateStarsWithMouse();
                    console.log('🎨 Animaciones activadas');
                }

                // 7. Event listeners básicos
                document.addEventListener('keypress', function (e) {
                    if (e.key === 'Enter') {
                        const loginOverlay = document.getElementById('loginOverlay');
                        if (loginOverlay && loginOverlay.style.display === 'flex') {
                            e.preventDefault();
                            attemptLogin();
                        }
                    }

                    if (e.key === ' ' && document.activeElement.tagName !== 'INPUT') {
                        e.preventDefault();
                        createShootingStar();
                    }
                });

                // 8. Cerrar login al hacer clic fuera
                document.addEventListener('click', function (e) {
                    const loginOverlay = document.getElementById('loginOverlay');
                    const loginBox = document.querySelector('.login-box');

                    if (loginOverlay && loginOverlay.style.display === 'flex' &&
                        loginBox && !loginBox.contains(e.target)) {
                        loginOverlay.style.display = 'none';
                    }
                });

                // 9. Ripples
                const interactiveElements = document.querySelectorAll('.time-unit, #configBtn, .logo');
                interactiveElements.forEach(element => {
                    element.addEventListener('click', function (e) {
                        createRipple(this, e);
                    });
                });

                // 10. Fecha listener
                const dateTimeInput = document.getElementById('targetDateTime');
                if (dateTimeInput) {
                    dateTimeInput.addEventListener('change', updateCountdown);
                }

                console.log('✅ SISTEMA COMPLETAMENTE FUNCIONAL!');
                console.log('🔑 Credenciales: AndreSM / andre1589');
                console.log('🎯 Haz clic en ⚙️ para probar');

                // 11. Test automático del botón y verificación de configuración
                setTimeout(() => {
                    console.log('🧪 TESTING FINAL - Verificando sistema...');
                    console.log('='.repeat(50));

                    // Test función
                    if (typeof openConfigSystem === 'function') {
                        console.log('✅ Función openConfigSystem disponible');
                    } else {
                        console.error('❌ Función openConfigSystem NO disponible');
                    }

                    // Test configuración automática
                    if (targetDate) {
                        console.log('✅ SISTEMA AUTOMÁTICO FUNCIONANDO:');
                        console.log(`🎯 Fecha objetivo: ${targetDate.toLocaleString()}`);
                        console.log(`📊 Días restantes: ${Math.floor((targetDate - new Date()) / (1000 * 60 * 60 * 24))}`);

                        // Detectar modo automáticamente
                        if (MONGODB_CONFIG.enabled) {
                            console.log('🌍 MODO GLOBAL AUTOMÁTICO ACTIVO');
                            console.log('👤 Administrador: Puede configurar para TODOS');
                            console.log('👥 Visitantes: Ven automáticamente la configuración del admin');
                            console.log('🚀 MongoDB se activa automáticamente cuando el admin configura');
                        } else {
                            console.log('💻 MODO LOCAL');
                            console.log('📝 Configuración solo en este navegador');
                            console.log('💡 Para modo global: pega tu connection string de MongoDB');
                        }

                        // Estado actual del usuario
                        if (isAuthenticated) {
                            console.log('🔐 ADMINISTRADOR AUTENTICADO');
                            console.log('⚙️ Puedes configurar la fecha para todos los visitantes');
                        } else {
                            console.log('👀 VISITANTE');
                            console.log('📺 Viendo la configuración del administrador');
                        }
                    } else {
                        console.error('❌ NO hay targetDate configurado');
                    }

                    console.log('='.repeat(50));
                    console.log('🎯 Botón listo - HAZ CLIC EN ⚙️ PARA CONFIGURAR');
                    console.log('🔑 Credenciales: AndreSM / andre1589');
                }, 2000);

            } catch (error) {
                console.error('❌ Error durante inicialización:', error);
            }
        });

        // Hacer funciones disponibles globalmente
        window.openConfigSystem = openConfigSystem;
        window.attemptLogin = attemptLogin;
        window.toggleConfig = toggleConfig;
        window.logout = logout;
        window.setQuickDate = setQuickDate;
        window.resetToDefault = resetToDefault;
        window.updateCountdown = updateCountdown;

        console.log('🌍 Sistema completamente funcional!');

        /*
        ===================================================================
        🚀 SISTEMA COMPLETAMENTE AUTOMÁTICO - MONGODB
        ===================================================================
        
        ¡YA NO NECESITAS CONFIGURAR NADA MANUALMENTE!
        
        🎯 CÓMO FUNCIONA AUTOMÁTICAMENTE:
        
        1️⃣ VISITANTES (SIN LOGIN):
           ✅ Entran a tu web
           ✅ Ven automáticamente la fecha que TÚ configuraste
           ✅ Se carga desde MongoDB automáticamente si está disponible
           ✅ Si MongoDB no está, usa localStorage como respaldo
           ✅ Sin login requerido - solo ven el countdown
        
        2️⃣ TÚ (ADMINISTRADOR):
           ✅ Haces clic en ⚙️
           ✅ Login: AndreSM / andre1589  
           ✅ Cambias la fecha
           ✅ Al guardar → AUTOMÁTICAMENTE se sincroniza en MongoDB
           ✅ TODOS los visitantes ven tu nueva configuración
        
        3️⃣ DETECCIÓN AUTOMÁTICA:
           ✅ Si pones connection string → Modo global automático
           ✅ Si no hay connection string → Modo local
           ✅ Administrador logueado → Puede configurar globalmente
           ✅ Visitantes → Solo ven, no pueden cambiar
        
        📋 PARA ACTIVAR MODO GLOBAL:
        
        1. Ve a: https://cloud.mongodb.com
        2. Crea cuenta gratis + cluster gratis
        3. Obtén tu connection string
        4. Pégalo arriba en connectionString: ""
        5. ¡LISTO! MongoDB se activa automáticamente
        
        ✨ BENEFICIOS DEL SISTEMA AUTOMÁTICO:
        ✅ Sin configuración manual
        ✅ Detección automática de administrador vs visitante  
        ✅ Fallback automático si MongoDB falla
        ✅ Logs claros de lo que está pasando
        ✅ Alertas informativas para el administrador
        ✅ Los visitantes nunca ven errores
        
        🎮 PARA PROBAR:
        1. Modo local: Funciona YA (sin MongoDB)
        2. Modo global: Pega connection string y ¡automático!
        
        ===================================================================
        */
    </script>
</body>

</html>
